#!/bin/bash

setup_php() {
    MESSAGE="Install PHP"
    sudo apt-get install -y php php-gd php-fpm php-common php-json php-zip php-mbstring php-xml >> bootstrap_install.logs 2>>bootstrap_error_install.logs
    # shellcheck disable=SC2181
    if [ $? -eq 0 ]; then
        print_sucess_message "$MESSAGE"
    else
        print_failed_message "$MESSAGE"
    fi
}

install_composer_packages() {
    MESSAGE="install php composer packages"
    PHP_PACKAGES=("phpunit/phpunit" "phing/phing" "phploc/phploc" "phpmd/phpmd" "squizlabs/php_codesniffer")
    INSTALLED_PACKAGES=$(composer global show)
    for i in "${PHP_PACKAGES[@]}"
    do
        if [ "$(echo "$INSTALLED_PACKAGES" | grep -c "$i")" -ne 1 ]; then
            composer global require "$i" -q -n > /dev/null >> bootstrap_install.logs 2>>bootstrap_error_install.logs
        fi
    done
    # shellcheck disable=SC2181
    if [ $? -eq 0 ]; then
        print_sucess_message "$MESSAGE"
    else
        print_failed_message "$MESSAGE"
    fi
}

print_message "Setup PHP Dev Environment"
setup_php
install_composer_packages
